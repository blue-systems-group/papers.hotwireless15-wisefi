\newpage
\clearpage

\section{Investigation}
\label{sec:investigation}

To investigate such reciprocal sharing opportunities, we obtain a \wifi{} scan
result dataset from \PhoneLab{} (\S\ref{subsec:phonelab}). We first develop
heuristics to identify home AP information for each device
(\S\ref{subsec:homeap}). Then we show the RSSI comparison between user's home
and neighbor APs (\S\ref{subsec:better}). Finally, we explore the reciprocal
sharing relationships in the dataset (\S\ref{subsec:reciprocal}).

\subsection{PhoneLab \wifi{} Dataset}
\label{subsec:phonelab}

\begin{table}[t]
  \begin{tabularx}{\columnwidth}{Xr}
    \toprule
    Begin & 11/7/2014 \\ 
    End & 4/3/2015 \\ 
    Duration (Days) & 147 \\ \midrule
    Participants & 254 \\
    Device Type & Nexus~5 \\ \midrule
    Scans & \num{21192417} \\
    Observed APs & \num{1197522} \\
    Used APs & \num{15668} \\ \midrule
    \wifi{} Sessions & \num{466032} \\
    Total Connection Time (Days) & \num{34721} \\
    \bottomrule
  \end{tabularx}
  \caption{\textbf{\PhoneLab{} \wifi{} Dataset Summary.} Used APs refers to the
  subset of total APs that were used by the devices participating in the study.}
  \label{tab:summary}
\end{table}

\PhoneLab{}\cite{phonelab-sensemine13} is a public smartphone platform testbed
operated at the University at Buffalo. Several hundreds of participants carry
instrumented Nexus 5 smartphones as their primary device. In particular, the
smartphone platform was modified to log each \wifi{} scan results as well as
connection events naturally generated by the Android system. Note that the same
information can also be collected by applications with appropriate permissions.
Table~\ref{tab:summary} summarizes the \PhoneLab{} \wifi{} dataset.

\wifi{} scan result represents the device's network visibility, and consists of
multiple entries---each corresponds to one \wifi{} Access Point (AP) the device
observed. The content of one entry includes: (1) beacon timestamp, (2) AP SSID
and BSSID, (3) AP channel and (4) RSSI. Additionally, the timestamp when the
scan was performed is also logged.

\subsection{Home AP Detection}
\label{subsec:homeap}

In following analysis, we focus on home \wifi{} networks which are more likely
to reveal stable and immediate reciprocal sharing opportunities. For this
purpose, we first develop several heuristics to identify the home AP for each
device in the dataset. The intuition is that the devices are most likely
connected to home AP at night. More specifically, we first identify a set of
home AP candidates for each device by looking at the \wifi{} sessions happened
during 12~AM and 4~AM every night during the data collection period. We then
eliminate false positives by filtering out candidate APs that provides fewer
than 100 sessions or less than 10 hours of total connection time.

After applying the above heuristics, the home AP information of 123 devices are
identified, including 118 unique SSIDs and 126 unique BSSIDs. Some factory
preset SSIDs, such as \texttt{linksys}, are used by multiple home APs, and
certain devices have multiple home BSSIDs due to 2.4/5~GHz dual band router or
AP replacement.

\subsection{\wifi{} Session Signal Strength}
\label{subsec:better}

After identified home AP information, we then ask these two questions: (1) When
the device is connected to home AP, how often does it receive a better signal
from neighbors' APs that it does not have access? and (2) Is there one
particular neighbor AP among others that consistently provides better signals
than the device's home AP?

To answer the first question, we inspect scan results that are reported during
\wifi{} sessions with home APs. For each such scan result, we identify the
currently associated home AP, $AP_{home}$, and the AP with best RSSI among all
reported APs, denoted as $AP_{best}$. We are particularly interested in which we
refer as \textit{sub-optimal} cases where: (1) $AP_{home} \neq AP_{best}$; (2)
the device never connects to $AP_{best}$ in the dataset; and (3) the RSSI of
$AP_{best}$ is better than $AP_{home}$ by at least certain threshold (5dBm in
our analysis). Such cases indicate that the device could potentially improve its
\wifi{} performance by connecting to neighbor APs which have better signals yet it
does not have access to. Note that here we only consider RSSI in determining the
\textit{optimal} AP and it is well understood that RSSI does not directly translate
to \wifi{} performance, which we will discuss in Section~\ref{sec:challenges}.
Also note that the cases when the device are not connected to APs with best
signal due to bad roaming strategies are not interesting in the context of this
paper, and are excluded by the second condition.

\begin{figure}[t]
  \centering
  \includegraphics[width=\columnwidth]{./figures/HomeAPSessionRSSI.pdf}
  \caption{\textbf{CDF of Sub-Optimal Connection Time.}}
  \label{fig:suboptimal}
\end{figure}

We classify all scan results reported during \wifi{} sessions with home APs into
two categories: sub-optimal and the rest. For each device, we calculate the
percentage of time when the scan results indicate sub-optimal association.
Figure~\ref{fig:suboptimal} shows the CDF of such percentage for 
the 123 devices. We make several observations. First, for 80\% of the devices,
their home APs usually provides best signal (sub-optimal percentage less than
20\%). This result is not particularly surprising considering that home APs are
usually carefully positioned to try to provide good coverage. Second, we notice
that for certain number of devices (10\%), their home APs failed to provide best
signal for more than 40\% of the time, suggesting that these users may benefit
from sharing the \wifi{} access of their neighbor APs.

Next, we are interested to see when the device is in a sub-optimal association
with its home AP, whether there exists a \textit{dominant} neighbor AP that
usually provides the best signal among other neighbor APs. If such dominant
neighbor AP exists, then by just sharing access of this one particular neighbor
AP, the device's sub-optimal association time can be largely reduced. To this
end, we look at all the scan results in sub-optimal category, and count the
number of times that each neighbor AP appears as $AP_{best}$. For each device,
we calculate the fraction of dominant neighbor AP. Figure~\ref{fig:dominantap}
shows the CDF of dominant AP fraction. For 50\% of the devices, one particular
neighbor AP contributes to more than 60\% of sub-optimal connection time,
implying that even by sharing \wifi{} access of one neighbor AP, these device's
sub-optimal connection time can be reduced by more than 60\%.

\begin{figure}[t]
  \centering
  \includegraphics[width=\columnwidth]{./figures/BetterNeighborAPFigure.pdf}
  \caption{\textbf{CDF of Dominant AP Fraction.}}
  \label{fig:dominantap}
\end{figure}


\subsection{Reciprocal Sharing}
\label{subsec:reciprocal}

Finally, we investigate the cases where two devices can obtain better signals
from each other's home AP, i.e., reciprocal sharing opportunity.

\newpage
\clearpage

